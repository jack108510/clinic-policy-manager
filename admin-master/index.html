<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSI Master Admin - Policy Manager Control Center</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="brand-text">
                    <h1>CSI Master Admin</h1>
                    <span>Policy Manager Control Center</span>
                </div>
            </div>
            
            <div class="nav-actions">
                <div class="nav-stats">
                    <div class="stat-item">
                        <i class="fas fa-building"></i>
                        <span id="headerCompanyCount">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-users"></i>
                        <span id="headerUserCount">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-file-alt"></i>
                        <span id="headerPolicyCount">0</span>
                    </div>
                </div>
                
                <div class="nav-user">
                    <div class="user-info">
                        <span class="user-name">Master Administrator</span>
                        <span class="user-role">System Admin</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <h3 class="section-title">Overview</h3>
                    <nav class="sidebar-nav">
                        <a href="#dashboard" class="nav-item active" data-section="dashboard">
                            <i class="fas fa-chart-pie"></i>
                            <span>Dashboard</span>
                        </a>
                        <a href="#analytics" class="nav-item" data-section="analytics">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a>
                    </nav>
                </div>

                <div class="sidebar-section">
                    <h3 class="section-title">Management</h3>
                    <nav class="sidebar-nav">
                        <a href="#companies" class="nav-item" data-section="companies">
                            <i class="fas fa-building"></i>
                            <span>Companies</span>
                            <span class="nav-badge" id="companyBadge">0</span>
                        </a>
                        <a href="#users" class="nav-item" data-section="users">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                            <span class="nav-badge" id="userBadge">0</span>
                        </a>
                        <a href="#access-codes" class="nav-item" data-section="access-codes">
                            <i class="fas fa-key"></i>
                            <span>Access Codes</span>
                        </a>
                    </nav>
                </div>

                <div class="sidebar-section">
                    <h3 class="section-title">Tools</h3>
                    <nav class="sidebar-nav">
                        <a href="#reports" class="nav-item" data-section="reports">
                            <i class="fas fa-file-download"></i>
                            <span>Reports</span>
                        </a>
                        <a href="#profile" class="nav-item" data-section="profile">
                            <i class="fas fa-user-cog"></i>
                            <span>Profile Center</span>
                        </a>
                        <a href="../index.html" class="nav-item external">
                            <i class="fas fa-external-link-alt"></i>
                            <span>Main Site</span>
                        </a>
                    </nav>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <div class="header-content">
                        <h2>Dashboard Overview</h2>
                        <p>Monitor system performance and key metrics</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showSection('companies')">
                            <i class="fas fa-plus"></i>
                            Add Company
                        </button>
                        <button class="btn btn-secondary" onclick="forceSyncToMainSite()">
                            <i class="fas fa-sync"></i>
                            Sync to Main Site
                        </button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon companies">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalCompanies">0</div>
                            <div class="stat-label">Total Companies</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+2 this month</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalUsers">0</div>
                            <div class="stat-label">Active Users</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+15 this week</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon policies">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalPolicies">0</div>
                            <div class="stat-label">Total Policies</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12 this week</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon active">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="activeCompanies">0</div>
                            <div class="stat-label">Active Companies</div>
                            <div class="stat-change neutral">
                                <i class="fas fa-minus"></i>
                                <span>No change</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions-section">
                    <h3>Quick Actions</h3>
                    <div class="actions-grid">
                        <button class="action-card" onclick="launchNewCompany()">
                            <div class="action-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="action-content">
                                <h4>Launch New Company</h4>
                                <p>Onboard a new organization</p>
                            </div>
                        </button>

                        <button class="action-card" onclick="showSection('access-codes')">
                            <div class="action-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="action-content">
                                <h4>Create Access Code</h4>
                                <p>Generate new access codes</p>
                            </div>
                        </button>

                        <button class="action-card" onclick="exportAllData()">
                            <div class="action-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="action-content">
                                <h4>Export Data</h4>
                                <p>Download reports and data</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="recent-activity-section">
                    <h3>Recent Activity</h3>
                    <div class="activity-feed" id="activityFeed">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Companies Section -->
            <section id="companies" class="content-section">
                <div class="section-header">
                    <div class="header-content">
                        <h2>Company Management</h2>
                        <p>Manage organizations and their access</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="refreshCompanies()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                        <button class="btn btn-primary" onclick="launchNewCompany()">
                            <i class="fas fa-plus"></i>
                            Add Company
                        </button>
                    </div>
                </div>

                <div class="filters-bar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="companySearch" placeholder="Search companies...">
                    </div>
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="data-table" id="companiesTable">
                        <thead>
                            <tr>
                                <th>Company</th>
                                <th>Users</th>
                                <th>Policies</th>
                                <th>Admin Password</th>
                                <th>API Configuration</th>
                                <th>Signup Date</th>
                                <th>Last Active</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="companiesList">
                            <!-- Companies will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="content-section">
                <div class="section-header">
                    <div class="header-content">
                        <h2>User Management</h2>
                        <p>Manage users across all organizations</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="refreshUsers()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                        <button class="btn btn-warning" onclick="syncFromMainSite()">
                            <i class="fas fa-download"></i>
                            Sync from Main Site
                        </button>
                        <button class="btn btn-danger" onclick="bulkDeleteUsers()">
                            <i class="fas fa-trash"></i>
                            Bulk Delete
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table" id="usersTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllUsers" onchange="toggleAllUsers()"></th>
                                <th>User</th>
                                <th>Company</th>
                                <th>Role</th>
                                <th>Created</th>
                                <th>Last Login</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersList">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Access Codes Section -->
            <section id="access-codes" class="content-section">
                <div class="section-header">
                    <div class="header-content">
                        <h2>Access Code Management</h2>
                        <p>Create and manage access codes for new companies</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showCreateCodeModal()">
                            <i class="fas fa-plus"></i>
                            Create Code
                        </button>
                    </div>
                </div>

                <div class="codes-grid" id="accessCodesList">
                    <!-- Access codes will be loaded here -->
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <div class="header-content">
                        <h2>Analytics & Insights</h2>
                        <p>System performance and usage analytics</p>
                    </div>
                </div>

                <div class="analytics-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Company Growth</h3>
                            <div class="chart-actions">
                                <button class="chart-btn active" data-period="month">Month</button>
                                <button class="chart-btn" data-period="year">Year</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="growthChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Policy Distribution</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="policyTypesChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>User Activity</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="activityChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Monthly Signups</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="signupsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section">
                <div class="section-header">
                    <div class="header-content">
                        <h2>Reports & Export</h2>
                        <p>Generate and download system reports</p>
                    </div>
                </div>

                <div class="reports-grid">
                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="report-content">
                            <h3>Company Report</h3>
                            <p>Comprehensive company data and statistics</p>
                            <button class="btn btn-primary" onclick="exportCompanyReport()">
                                <i class="fas fa-download"></i>
                                Export CSV
                            </button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="report-content">
                            <h3>User Report</h3>
                            <p>User activity and engagement data</p>
                            <button class="btn btn-primary" onclick="exportUserReport()">
                                <i class="fas fa-download"></i>
                                Export CSV
                            </button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="report-content">
                            <h3>Analytics Report</h3>
                            <p>System analytics and performance metrics</p>
                            <button class="btn btn-primary" onclick="exportAnalyticsReport()">
                                <i class="fas fa-download"></i>
                                Export CSV
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Center Section -->
            <section id="profile" class="content-section">
                <div class="section-header">
                    <div class="header-content">
                        <h2>Profile Center</h2>
                        <p>Manage your account settings and preferences</p>
                    </div>
                </div>

                <div class="profile-grid">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="profile-info">
                                <h3>Master Administrator</h3>
                                <p>System Administrator</p>
                                <span class="profile-status active">Active</span>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn btn-primary" onclick="showChangePasswordModal()">
                                <i class="fas fa-key"></i>
                                Change Password
                            </button>
                        </div>
                    </div>

                    <div class="profile-card">
                        <div class="profile-section">
                            <h4>Account Information</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Username</label>
                                    <span>master_admin</span>
                                </div>
                                <div class="info-item">
                                    <label>Email</label>
                                    <span>admin@csi.com</span>
                                </div>
                                <div class="info-item">
                                    <label>Role</label>
                                    <span>System Administrator</span>
                                </div>
                                <div class="info-item">
                                    <label>Last Login</label>
                                    <span id="lastLoginTime">Just now</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-card">
                        <div class="profile-section">
                            <h4>Security Settings</h4>
                            <div class="security-options">
                                <div class="security-item">
                                    <div class="security-info">
                                        <h5>Two-Factor Authentication</h5>
                                        <p>Add an extra layer of security to your account</p>
                                    </div>
                                    <button class="btn btn-secondary" onclick="enable2FA()">
                                        Enable 2FA
                                    </button>
                                </div>
                                <div class="security-item">
                                    <div class="security-info">
                                        <h5>Session Management</h5>
                                        <p>Manage active sessions and devices</p>
                                    </div>
                                    <button class="btn btn-secondary" onclick="manageSessions()">
                                        Manage Sessions
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-card">
                        <div class="profile-section">
                            <h4>System Preferences</h4>
                            <div class="preference-options">
                                <div class="preference-item">
                                    <label>
                                        <input type="checkbox" checked>
                                        Email notifications for new companies
                                    </label>
                                </div>
                                <div class="preference-item">
                                    <label>
                                        <input type="checkbox" checked>
                                        Weekly analytics reports
                                    </label>
                                </div>
                                <div class="preference-item">
                                    <label>
                                        <input type="checkbox">
                                        Daily activity summaries
                                    </label>
                                </div>
                                <div class="preference-item">
                                    <label>
                                        <input type="checkbox" checked>
                                        System maintenance alerts
                                    </label>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="savePreferences()">
                                Save Preferences
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="launchCompanyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Launch New Company</h3>
                <button class="modal-close" onclick="closeLaunchModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="launchCompanyForm" onsubmit="launchCompany(event)">
                    <div class="form-group">
                        <label for="companyName">Company Name</label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="adminName">Admin Name</label>
                        <input type="text" id="adminName" required>
                    </div>
                    <div class="form-group">
                        <label for="adminEmail">Admin Email</label>
                        <input type="email" id="adminEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="adminUsername">Admin Username</label>
                        <input type="text" id="adminUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="accessCode">Access Code</label>
                        <select id="accessCode" required>
                            <option value="">Select Access Code</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeLaunchModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Launch Company</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="createCodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Access Code</h3>
                <button class="modal-close" onclick="closeCreateCodeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="createCodeForm" onsubmit="createAccessCode(event)">
                    <div class="form-group">
                        <label for="newAccessCode">Access Code</label>
                        <input type="text" id="newAccessCode" required>
                    </div>
                    <div class="form-group">
                        <label for="codeDescription">Description</label>
                        <input type="text" id="codeDescription" required>
                    </div>
                    <div class="form-group">
                        <label for="codeExpiry">Expiry Date (optional)</label>
                        <input type="date" id="codeExpiry">
                    </div>
                    <div class="form-group">
                        <label for="maxCompanies">Max Companies</label>
                        <input type="number" id="maxCompanies" min="1" value="10">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateCodeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Code</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="companyDetailsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="companyDetailsTitle">Company Details</h3>
                <button class="modal-close" onclick="closeCompanyDetailsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="companyDetailsContent">
                    <!-- Company details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button class="modal-close" onclick="closeChangePasswordModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm" onsubmit="changePassword(event)">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" required minlength="8">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" id="confirmPassword" required minlength="8">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeChangePasswordModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Company Admin Password Modal -->
    <div id="companyPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Set Company Admin Password</h3>
                <button class="modal-close" onclick="closeCompanyPasswordModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="companyPasswordForm">
                    <div class="form-group">
                        <label for="passwordCompanyName">Company</label>
                        <input type="text" id="passwordCompanyName" readonly>
                    </div>
                    <div class="form-group">
                        <label for="newCompanyPassword">New Admin Password</label>
                        <input type="password" id="newCompanyPassword" required placeholder="Enter new admin password">
                    </div>
                    <div class="form-group">
                        <label for="confirmCompanyPassword">Confirm Password</label>
                        <input type="password" id="confirmCompanyPassword" required placeholder="Confirm new password">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCompanyPasswordModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Set Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Company API Configuration Modal -->
    <div id="companyAPIModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configure Company API Settings</h3>
                <button class="modal-close" onclick="closeCompanyAPIModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="companyAPIForm">
                    <div class="form-group">
                        <label for="apiCompanyName">Company</label>
                        <input type="text" id="apiCompanyName" readonly>
                    </div>
                    <div class="form-group">
                        <label for="companyAPIKey">OpenAI API Key</label>
                        <input type="password" id="companyAPIKey" placeholder="Enter OpenAI API key for this company">
                        <small class="form-help">
                            Get API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="apiStatus">API Status</label>
                        <div id="apiStatus" class="api-status">
                            <!-- API status will be displayed here -->
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCompanyAPIModal()">Cancel</button>
                        <button type="button" class="btn btn-info" onclick="testCompanyAPI()">Test API</button>
                        <button type="button" class="btn btn-primary" onclick="saveCompanyAPIKey()">Save API Key</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>