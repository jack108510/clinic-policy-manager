<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Policy Pro</title>
    <link rel="stylesheet" href="styles.css?v=207&t=20250128">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Landing Page (shown to non-logged-in users) -->
    <div id="landingPage" class="landing-page">
        <div class="landing-hero" style="position: relative; overflow: hidden; background: url('https://images.unsplash.com/photo-1556761175-4b46a572b786?w=1920&auto=format') center/cover no-repeat;">
            <!-- Gradient Overlay for Better Text Readability -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(118, 75, 162, 0.8) 100%); z-index: 1;"></div>
            
            <div class="landing-header" style="position: relative; z-index: 2;">
                <div class="landing-logo">
                    <img src="policy-pro-logo.svg" alt="Policy Pro Logo" style="height: 60px;">
                </div>
                <div class="landing-auth">
                    <button onclick="showLoginModal()" class="btn-landing btn-login">
                        <i class="fas fa-sign-in-alt"></i> Log In
                    </button>
                    <button onclick="showSignupModal()" class="btn-landing btn-signup">
                        <i class="fas fa-user-plus"></i> Sign Up
                    </button>
                </div>
            </div>
            
            <div class="landing-content" style="position: relative; z-index: 2;">
                <h1 class="landing-title">Policy Pro</h1>
                <p class="landing-subtitle">Secure, organized, and compliant policy management for your organization</p>
                <div class="landing-buttons">
                    <button onclick="startDemo()" class="btn btn-primary btn-large" style="background: #667eea; border-color: #667eea;">
                        <i class="fas fa-play-circle"></i> Try Demo
                    </button>
                    <button onclick="showLoginModal()" class="btn btn-primary btn-large" style="background: white; color: #667eea; font-weight: 600; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                        Get Started
                    </button>
                    <button onclick="showSignupModal()" class="btn btn-secondary btn-large">Create Account</button>
                </div>
            </div>
        </div>
        
        <section class="landing-about">
            <div class="container">
                <h2>About Policy Pro</h2>
                <div class="about-content">
                    <div class="about-card">
                        <div class="about-icon">
                            <i class="fas fa-file-shield"></i>
                        </div>
                        <h3>Secure Management</h3>
                        <p>Keep your policies organized and secure with enterprise-grade security features.</p>
                    </div>
                    <div class="about-card">
                        <div class="about-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3>AI-Powered Creation</h3>
                        <p>Generate professional policies quickly with our AI assistant powered by ChatGPT.</p>
                    </div>
                    <div class="about-card">
                        <div class="about-icon">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <h3>Team Collaboration</h3>
                        <p>Manage team access, assign responsibilities, and track policy compliance.</p>
                    </div>
                    <div class="about-card">
                        <div class="about-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>Stay Compliant</h3>
                        <p>Ensure your policies meet industry standards and best practices.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- FAQ Section -->
        <section class="landing-faq" style="padding: 80px 0; background: white;">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 50px; color: #333;">Frequently Asked Questions</h2>
                <div style="max-width: 800px; margin: 0 auto;">
                    <div class="faq-item" style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s;" onclick="this.querySelector('.faq-answer').style.display = this.querySelector('.faq-answer').style.display === 'block' ? 'none' : 'block'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; color: #333; font-size: 1.2rem;">How secure is my policy data?</h3>
                            <i class="fas fa-chevron-down" style="color: #667eea;"></i>
                        </div>
                        <div class="faq-answer" style="display: none; margin-top: 15px; color: #666; line-height: 1.6;">Your data is protected with enterprise-grade encryption and stored securely. We use industry-standard security practices to ensure your policies remain confidential and accessible only to authorized users.</div>
                    </div>
                    
                    <div class="faq-item" style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s;" onclick="this.querySelector('.faq-answer').style.display = this.querySelector('.faq-answer').style.display === 'block' ? 'none' : 'block'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; color: #333; font-size: 1.2rem;">Can I generate policies with AI?</h3>
                            <i class="fas fa-chevron-down" style="color: #667eea;"></i>
                        </div>
                        <div class="faq-answer" style="display: none; margin-top: 15px; color: #666; line-height: 1.6;">Yes! Our AI policy assistant uses ChatGPT to generate professional, comprehensive policies based on your specific requirements. Simply provide a topic and key points, and we'll handle the rest.</div>
                    </div>
                    
                    <div class="faq-item" style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s;" onclick="this.querySelector('.faq-answer').style.display = this.querySelector('.faq-answer').style.display === 'block' ? 'none' : 'block'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; color: #333; font-size: 1.2rem;">How does team collaboration work?</h3>
                            <i class="fas fa-chevron-down" style="color: #667eea;"></i>
                        </div>
                        <div class="faq-answer" style="display: none; margin-top: 15px; color: #666; line-height: 1.6;">You can assign policies to specific users, track who has reviewed them, and manage access levels. Each organization can have multiple users with different permission levels (admin or user).</div>
                    </div>
                    
                    <div class="faq-item" style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s;" onclick="this.querySelector('.faq-answer').style.display = this.querySelector('.faq-answer').style.display === 'block' ? 'none' : 'block'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; color: #333; font-size: 1.2rem;">Is there a free trial?</h3>
                            <i class="fas fa-chevron-down" style="color: #667eea;"></i>
                        </div>
                        <div class="faq-answer" style="display: none; margin-top: 15px; color: #666; line-height: 1.6;">Yes! You can sign up for free and start using Policy Pro immediately. Create an account to explore all features including AI-powered policy generation and team management.</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- CTA Section -->
        <section class="landing-cta" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 80px 0; text-align: center; color: white;">
            <div class="container">
                <h2 style="font-size: 2.5rem; margin-bottom: 20px;">Ready to Transform Your Policy Management?</h2>
                <p style="font-size: 1.3rem; margin-bottom: 40px; opacity: 0.95;">Join organizations using Policy Pro today</p>
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="startDemo()" class="btn btn-large" style="background: #667eea; color: white; font-weight: 600; padding: 15px 40px; font-size: 1.2rem; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
                        <i class="fas fa-play-circle"></i> Try Live Demo
                    </button>
                    <button onclick="showSignupModal()" class="btn btn-large" style="background: white; color: #667eea; font-weight: 600; padding: 15px 40px; font-size: 1.2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">Start Free Trial</button>
                    <button onclick="showLoginModal()" class="btn btn-large" style="background: rgba(255,255,255,0.2); color: white; font-weight: 600; padding: 15px 40px; font-size: 1.2rem; border: 2px solid white;">Log In</button>
                </div>
            </div>
        </section>
        
        </section>
    </div>

    <!-- Feature Tour Overlay (lighter, non-blocking) -->
    <div id="tourOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 9998; pointer-events: none;"></div>
    
    <!-- Feature Tour Modal (bottom-right corner, penguin style, helper guide) -->
    <div id="tourModal" style="display: none; position: fixed; bottom: 30px; right: 30px; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); z-index: 9999; max-width: 380px; text-align: left; border: 3px solid #667eea; overflow: hidden;">
        <div id="tourContent">
            <div style="display: flex; align-items: flex-start; margin-bottom: 15px;">
                <div id="tourIcon" style="font-size: 48px; margin-right: 12px; flex-shrink: 0; position: relative; animation: penguinDance 4s infinite ease-in-out;">
                    <div style="transform: perspective(500px) rotateY(-10deg) rotateX(-5deg) translateZ(20px); transition: transform 0.3s; animation: penguinWaddle 2s infinite ease-in-out;">
                        üêß
                    </div>
                </div>
                <div style="flex: 1;">
                    <h2 id="tourTitle" style="margin: 0 0 8px 0; color: #333; font-size: 1.2rem; line-height: 1.3;">Welcome to Policy Pro!</h2>
                    <p id="tourDescription" style="color: #666; line-height: 1.5; margin: 0; font-size: 0.95rem;">Let's explore the key features together. Click "Next" to continue or interact with the page!</p>
                </div>
            </div>
            <style>
                @keyframes penguinDance {
                    0%, 100% { 
                        transform: perspective(500px) rotateY(0deg) rotateX(0deg) scale(1); 
                    }
                    25% { 
                        transform: perspective(500px) rotateY(-15deg) rotateX(5deg) scale(1.1); 
                    }
                    50% { 
                        transform: perspective(500px) rotateY(15deg) rotateX(-5deg) scale(0.95); 
                    }
                    75% { 
                        transform: perspective(500px) rotateY(-10deg) rotateX(3deg) scale(1.05); 
                    }
                }
                @keyframes penguinWaddle {
                    0%, 100% { 
                        transform: perspective(500px) rotateY(-10deg) rotateX(-5deg) translateZ(20px) rotateZ(0deg); 
                    }
                    25% { 
                        transform: perspective(500px) rotateY(-12deg) rotateX(-3deg) translateZ(25px) rotateZ(-8deg); 
                    }
                    50% { 
                        transform: perspective(500px) rotateY(-8deg) rotateX(-7deg) translateZ(15px) rotateZ(0deg); 
                    }
                    75% { 
                        transform: perspective(500px) rotateY(-12deg) rotateX(-3deg) translateZ(25px) rotateZ(8deg); 
                    }
                }
                #tourIcon:hover > div {
                    animation: penguinJump 0.5s ease-in-out !important;
                    transform: perspective(500px) rotateY(0deg) rotateX(-30deg) translateZ(50px) scale(1.3) !important;
                }
                @keyframes penguinJump {
                    0% { transform: perspective(500px) rotateY(-10deg) rotateX(-5deg) translateZ(0px) scale(1); }
                    50% { transform: perspective(500px) rotateY(0deg) rotateX(-30deg) translateZ(50px) scale(1.3); }
                    100% { transform: perspective(500px) rotateY(-10deg) rotateX(-5deg) translateZ(20px) scale(1); }
                }
            </style>
            <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                <button id="tourSkip" onclick="skipTour()" style="padding: 8px 16px; border: 1px solid #ddd; background: white; color: #666; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 0.9rem;">Skip</button>
                <button id="tourNext" onclick="nextTourStep()" style="padding: 8px 16px; border: none; background: #667eea; color: white; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem;">Next ‚Üí</button>
            </div>
            <!-- Timer countdown display -->
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
                <div style="flex: 1; position: relative; height: 8px; background: #e9ecef; border-radius: 10px; overflow: hidden;">
                    <div id="tourProgressBar" style="position: absolute; top: 0; left: 0; width: 0%; height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); border-radius: 10px; transition: width 0.1s linear; box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);"></div>
                </div>
                <div id="tourCountdown" style="font-size: 0.85rem; font-weight: 600; color: #667eea; min-width: 35px; text-align: right;">20s</div>
            </div>
        </div>
        <style>
            @keyframes pulse {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-5px); }
            }
        </style>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="policy-pro-logo.svg" alt="Logo" class="logo-img">
            </div>
            <div class="nav-menu">
                <a href="#home" class="nav-link" onclick="return requireLogin()"><i class="fas fa-home"></i> Home</a>
                <a href="#policies" class="nav-link" onclick="return requireLogin()"><i class="fas fa-file-alt"></i> Policies</a>
                <a href="#drafts" class="nav-link" onclick="return requireLogin()"><i class="fas fa-edit"></i> Drafts</a>
                <a href="#" onclick="event.preventDefault(); openPolicyAdvisor(); return false;" class="nav-link"><i class="fas fa-robot"></i> Policy Advisor</a>
                <span class="nav-divider"></span>
                <a href="#" onclick="openPasswordModal()" class="nav-link admin-link"><i class="fas fa-tachometer-alt"></i> Admin</a>
                <a href="#" onclick="showProfileModal()" class="nav-link"><i class="fas fa-user-circle"></i> Profile</a>
                <span class="nav-divider"></span>
                <div class="notification-dropdown">
                    <a href="#" class="nav-link" onclick="event.preventDefault(); toggleNotificationCenter(); return false;">
                        <i class="fas fa-bell"></i> Notifications
                        <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                    </a>
                    <div id="notificationCenter" class="notification-menu" style="display: none;">
                        <div class="notification-header">
                            <h4>Notifications</h4>
                            <button onclick="event.stopPropagation(); clearAllNotifications();" class="btn-link">Clear All</button>
                    </div>
                        <div id="notificationList" class="notification-list">
                            <div class="no-notifications">No new notifications</div>
                </div>
                    </div>
                </div>
                <span class="nav-divider auth-buttons-divider"></span>
                <a href="#" onclick="showLoginModal()" class="nav-link auth-btn auth-button">Login</a>
                <a href="#" onclick="showSignupModal()" class="nav-link auth-btn signup-btn auth-button">Sign Up</a>
                <a href="#" onclick="logoutUser()" class="nav-link auth-signout" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </a>
            </div>
            <div class="nav-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero" style="position: relative; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <!-- Animated Pattern Background -->
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.15; z-index: 0;">
            <svg width="100%" height="100%" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
                        <circle cx="25" cy="25" r="3" fill="white"/>
                        <circle cx="12.5" cy="12.5" r="1.5" fill="white"/>
                        <circle cx="37.5" cy="37.5" r="1.5" fill="white"/>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)"/>
            </svg>
        </div>
        
        <!-- Decorative Circles -->
        <div style="position: absolute; top: -100px; right: -50px; width: 300px; height: 300px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); z-index: 1;"></div>
        <div style="position: absolute; bottom: -80px; left: 10%; width: 200px; height: 200px; border-radius: 50%; background: rgba(255, 255, 255, 0.08); z-index: 1;"></div>
        
        <div class="hero-content" style="position: relative; z-index: 2;">
            <h1 style="color: white; font-size: 3.5rem; margin-bottom: 1rem; text-shadow: 0 2px 20px rgba(0,0,0,0.1);">Policy Pro</h1>
            <p style="color: rgba(255, 255, 255, 0.95); font-size: 1.3rem; margin-bottom: 2rem;">Secure, organized, and compliant policy management</p>
            <div class="hero-buttons">
                <a href="#policies" class="btn btn-primary" style="background: white; color: #667eea; font-weight: 600; box-shadow: 0 4px 20px rgba(0,0,0,0.2);" onclick="return requireLogin()">View All Policies</a>
                <a href="#" onclick="openPasswordModal()" class="btn btn-secondary" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white;">Admin Dashboard</a>
            </div>
        </div>
    </section>

    <!-- Policy Types Section -->
    <section class="policy-types">
        <div class="container">
            <h2>Policy Categories</h2>
            <div class="policy-grid">
                <div class="policy-card" data-type="admin">
                    <div class="policy-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h3>Admin Policies</h3>
                    <p>Administrative procedures and governance policies</p>
                    <a href="#admin" class="btn btn-outline" onclick="return requireLogin()">View Admin Policies</a>
                </div>
                <div class="policy-card" data-type="sog">
                    <div class="policy-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <h3>Standard Operating Guidelines</h3>
                    <p>Operational procedures and clinical guidelines</p>
                    <a href="#sog" class="btn btn-outline" onclick="return requireLogin()">View SOG</a>
                </div>
                <div class="policy-card" data-type="protocol">
                    <div class="policy-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <h3>Protocols</h3>
                    <p>Detailed procedures and workflows</p>
                    <a href="#protocols" class="btn btn-outline" onclick="return requireLogin()">View Protocols</a>
                </div>
                <div class="policy-card" data-type="memos">
                    <div class="policy-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>Communication Memos</h3>
                    <p>Internal communications and announcements</p>
                    <a href="#memos" class="btn btn-outline" onclick="return requireLogin()">View Memos</a>
                </div>
                <div class="policy-card" data-type="training">
                    <div class="policy-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <h3>Training Documents</h3>
                    <p>Educational materials and training resources</p>
                    <a href="#training" class="btn btn-outline" onclick="return requireLogin()">View Training</a>
                </div>
                <div class="policy-card" data-type="governance">
                    <div class="policy-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <h3>Governance Policies</h3>
                    <p>Corporate governance and compliance policies</p>
                    <a href="#governance" class="btn btn-outline" onclick="return requireLogin()">View Governance</a>
                </div>
            </div>
        </div>
    </section>


    <!-- All Policies Section -->
    <section id="policies" class="policies">
        <div class="container">
            <h2>All Policies</h2>
            <div class="search-bar">
                <input type="text" id="policySearch" placeholder="Search policies...">
                <i class="fas fa-search"></i>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all" onclick="return requireLogin()">All Policies</button>
                <button class="filter-btn" data-filter="admin" onclick="return requireLogin()">Admin</button>
                <button class="filter-btn" data-filter="sog" onclick="return requireLogin()">Standard Operating Guidelines</button>
                <button class="filter-btn" data-filter="protocol" onclick="return requireLogin()">Protocols</button>
                <button class="filter-btn" data-filter="memo" onclick="return requireLogin()">Communication Memos</button>
                <button class="filter-btn" data-filter="training" onclick="return requireLogin()">Training Documents</button>
                <button class="filter-btn" data-filter="governance" onclick="return requireLogin()">Governance Policies</button>
            </div>
            <div class="policies-grid" id="policiesGrid">
                <!-- Policies will be loaded here -->
            </div>
        </div>
    </section>
    
    <!-- Drafts Section -->
    <section id="drafts" class="policies" style="background: #f8fafc;">
        <div class="container">
            <h2><i class="fas fa-edit"></i> Draft Policies</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">Manage your work-in-progress policies</p>
            <div id="draftList" class="draft-list" style="max-width: 900px; margin: 0 auto;">
                <!-- Drafts will be displayed here -->
            </div>
        </div>
    </section>


    <!-- Create Policy Modal -->
    <div id="createModal" class="modal" style="z-index: 3500;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Policy</h3>
                <span class="close" onclick="closeCreateModal()">&times;</span>
            </div>
            <form id="policyForm" class="modal-body">
                <div class="form-group">
                    <label for="policyTitle">Policy Title</label>
                    <input type="text" id="policyTitle" placeholder="Enter policy title (optional)">
                </div>
                <div class="form-group">
                    <label for="policyType">Policy Type</label>
                    <select id="policyType" onchange="updateManualFormFields()">
                        <option value="">Select Type</option>
                        <option value="admin">Admin Policy</option>
                        <option value="sog">Standard Operating Guidelines</option>
                        <option value="protocol">Protocol</option>
                        <option value="memo">Communication Memo</option>
                        <option value="training">Training Document</option>
                        <option value="governance">Governance Policy</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="clinicApplicability">Organization Applicability</label>
                    <select id="clinicApplicability" multiple style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px;">
                        <option value="">Loading organizations...</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 5px;">Hold Ctrl/Cmd to select multiple organizations</small>
                </div>
                
                <div class="form-group">
                    <label for="manualPolicyCategory">
                        <i class="fas fa-tags"></i> Category (for policy code generation)
                    </label>
                    <select id="manualPolicyCategory" onchange="updateManualPolicyCode()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">No Category (optional)</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 5px;">Policy code will be generated in format: Type.Category#.Policy#.Year (e.g., ADMIN.1.2.2025)</small>
                    <div id="manualPolicyCodeDisplay" style="display: none; margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 6px;">
                        <strong>Policy Code:</strong> <span id="manualPolicyCodeText"></span>
                    </div>
                </div>
                
                <!-- Dynamic form fields based on policy type -->
                <div id="dynamicManualFormFields">
                    <!-- Fields will be populated based on policy type selection -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Policy</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Policy View Modal -->
    <div id="policyViewModal" class="modal" style="z-index: 2500;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="policyViewTitle">Policy Details</h3>
                <span class="close" onclick="closePolicyViewModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="policyViewContent">
                    <!-- Policy content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Policy Edit Modal -->
    <div id="policyEditModal" class="modal" style="z-index: 3500;">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px;">
                <h3 style="margin: 0; color: white;"><i class="fas fa-edit"></i> Edit Policy</h3>
                <span class="close" onclick="closePolicyEditModal()" style="color: white;">&times;</span>
            </div>
            <div class="modal-body" style="padding: 25px;">
                <form id="policyEditForm" onsubmit="savePolicyEdit(event)">
                    <input type="hidden" id="editPolicyId">
                    
                    <!-- Basic Information -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-info-circle"></i> Basic Information
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label for="editPolicyTitle">Policy Title</label>
                                <input type="text" id="editPolicyTitle" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            
                            <div class="form-group">
                                <label for="editPolicyType">Policy Type</label>
                                <select id="editPolicyType" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="admin">Admin Policy</option>
                                    <option value="sog">Standard Operating Guidelines</option>
                                    <option value="protocol">Protocol</option>
                                    <option value="memo">Communication Memo</option>
                                    <option value="training">Training Document</option>
                                    <option value="reference">Reference Document</option>
                                    <option value="governance">Governance Policy</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div class="form-group">
                                <label for="editPolicyEffectiveDate">Effective Date</label>
                                <input type="date" id="editPolicyEffectiveDate" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            
                            <div class="form-group">
                                <label for="editPolicyVersion">Version</label>
                                <input type="text" id="editPolicyVersion" value="1.0" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="editPolicyCode">Category</label>
                            <select id="editPolicyCode" onchange="updatePolicyCode()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Select a category (optional)</option>
                                <!-- Categories will be dynamically populated here -->
                            </select>
                            <small style="color: #666; display: block; margin-top: 5px;">Manage categories in Settings > Categories</small>
                        </div>
                        
                        <div class="form-group" id="policyCodeDisplay" style="margin-top: 15px; display: none;">
                            <label>Generated Policy Code</label>
                            <input type="text" id="editPolicyCodeDisplay" readonly style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa; font-weight: bold; color: #667eea;">
                            <small style="color: #666; display: block; margin-top: 5px;">Code format: Type.Category#.Policy#.Year (e.g., ADMIN.1.2.2025)</small>
                        </div>
                    </div>
                    
                    <!-- Organizations -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-building"></i> Applicable Organizations
                        </h4>
                        <div id="editOrganizationsList">
                            <!-- Organizations checkboxes will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Policy Sections -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-file-text"></i> Policy Content
                        </h4>
                        
                        <div class="form-group">
                            <label for="editPolicyPurpose">Purpose</label>
                            <textarea id="editPolicyPurpose" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="State the purpose of this policy..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPolicyScope">Scope</label>
                            <textarea id="editPolicyScope" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Who does this policy apply to?"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPolicyStatement">Policy Statement</label>
                            <textarea id="editPolicyStatement" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="The main policy statement..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPolicyProcedures">Procedures</label>
                            <textarea id="editPolicyProcedures" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Step-by-step procedures..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPolicyResponsibilities">Responsibilities</label>
                            <textarea id="editPolicyResponsibilities" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Who is responsible for what?"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPolicyConsequences">Consequences / Non-Compliance</label>
                            <textarea id="editPolicyConsequences" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="What happens if not followed?"></textarea>
                        </div>
                    </div>
                    
                    <!-- Related Documents -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-paperclip"></i> Related Documents
                        </h4>
                        <p style="margin-bottom: 15px; color: #666;">Link this policy to related documents</p>
                        <div id="editRelatedDocumentsList">
                            <!-- Document checkboxes will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Additional Content (for legacy or custom content) -->
                    <div class="form-group">
                        <label for="editPolicyContent">Additional Content (Optional)</label>
                        <textarea id="editPolicyContent" rows="5" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;" placeholder="Any additional notes or custom content..."></textarea>
                        <small style="color: #666;">Use this field for any additional information that doesn't fit in the structured fields above.</small>
                    </div>
                    
                    <div class="form-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closePolicyEditModal()" style="padding: 12px 24px;">Cancel</button>
                        <button type="submit" class="btn btn-primary" style="padding: 12px 24px;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <span class="close" onclick="closeSettingsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="tab-btn active" onclick="showSettingsTab('roles')">
                        <i class="fas fa-users"></i> Roles & Responsibilities
                    </button>
                    <button class="tab-btn" onclick="showSettingsTab('disciplinary')">
                        <i class="fas fa-gavel"></i> Disciplinary Actions
                    </button>
                    <button class="tab-btn" onclick="showSettingsTab('organizations')">
                        <i class="fas fa-building"></i> Organizations
                    </button>
                    <button class="tab-btn" onclick="showSettingsTab('documents')">
                        <i class="fas fa-file-alt"></i> Documents
                    </button>
                    <button class="tab-btn" onclick="showSettingsTab('categories')">
                        <i class="fas fa-folder"></i> Categories
                    </button>
                </div>
                
                <!-- Roles Tab -->
                <div id="rolesTab" class="settings-tab active">
                    <div class="settings-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <h3 style="margin: 0;">Manage Roles & Responsibilities</h3>
                            <button onclick="openAddRoleModal()" class="btn btn-primary" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 15px; font-weight: 600;">
                                <i class="fas fa-plus-circle"></i> Add New Role
                            </button>
                        </div>
                        <div class="items-list" id="rolesList">
                            <!-- Roles will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Disciplinary Actions Tab -->
                <div id="disciplinaryTab" class="settings-tab">
                    <div class="settings-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <h3 style="margin: 0;">Manage Disciplinary Actions</h3>
                            <button onclick="openAddDisciplinaryModal()" class="btn btn-primary" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 15px; font-weight: 600;">
                                <i class="fas fa-plus-circle"></i> Add New Action
                            </button>
                        </div>
                        <div class="items-list" id="disciplinaryList">
                            <!-- Disciplinary actions will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Organizations Tab -->
                <div id="organizationsTab" class="settings-tab">
                    <div class="settings-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <h3 style="margin: 0;">Manage Organizations</h3>
                            <button onclick="openAddOrganizationModal()" class="btn btn-primary" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 15px; font-weight: 600;">
                                <i class="fas fa-plus-circle"></i> Add New Organization
                            </button>
                        </div>
                        <div class="items-list" id="organizationsList">
                            <!-- Organizations will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Documents Tab -->
                <div id="documentsTab" class="settings-tab">
                    <div class="settings-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="margin: 0;">Related Documents</h3>
                                <p style="margin: 5px 0 0 0; color: #666;">Store and manage documents that can be linked to policies</p>
            </div>
                            <button onclick="openAddDocumentModal()" class="btn btn-primary" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 15px; font-weight: 600;">
                                <i class="fas fa-plus-circle"></i> Add New Document
                            </button>
                        </div>
                        
                        <div id="documentsList" class="items-list" style="margin-top: 20px;">
                            <!-- Documents will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Categories Tab -->
                <div id="categoriesTab" class="settings-tab">
                    <div class="settings-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <div>
                                <h3 style="margin: 0; color: #1f2937;">Policy Categories</h3>
                                <p style="margin: 5px 0 0 0; color: #666; font-size: 0.95rem;">Organize policies with categories for automatic code generation</p>
                            </div>
                            <button onclick="openAddCategoryModal()" class="btn btn-primary" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 15px; font-weight: 600;">
                                <i class="fas fa-plus-circle"></i> Add New Category
                            </button>
                        </div>
                        
                        <div id="categoriesList" class="items-list" style="margin-top: 20px;">
                            <!-- Categories will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- AI Policy Chat Modal -->
    <div id="aiModal" class="modal">
        <div class="modal-content chat-modal">
            <div class="modal-header">
                <h3><i class="fas fa-robot"></i> AI Policy Assistant</h3>
                <p class="ai-subtitle">Create professional policies with AI assistance</p>
                <span class="close" onclick="closeAIModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="policy-type-selection">
                    <h4>Select Policy Type:</h4>
                    <div class="policy-type-toggles">
                        <label class="toggle-item">
                            <input type="radio" name="policyType" value="admin" checked>
                            <span class="toggle-label">Admin Policy</span>
                        </label>
                        <label class="toggle-item">
                            <input type="radio" name="policyType" value="sog">
                            <span class="toggle-label">Standard Operating Guidelines</span>
                        </label>
                        <label class="toggle-item">
                            <input type="radio" name="policyType" value="protocol">
                            <span class="toggle-label">Protocol</span>
                        </label>
                        <label class="toggle-item">
                            <input type="radio" name="policyType" value="memo">
                            <span class="toggle-label">Communication Memo</span>
                        </label>
                        <label class="toggle-item">
                            <input type="radio" name="policyType" value="training">
                            <span class="toggle-label">Training Document</span>
                        </label>
                        <label class="toggle-item">
                            <input type="radio" name="policyType" value="governance">
                            <span class="toggle-label">Governance Policy</span>
                        </label>
                    </div>
                </div>
                
                <div class="policy-options-selection">
                    <h4>Policy Options:</h4>
                    <div class="policy-options-grid">
                        <div class="option-group">
                            <h5>Applicable Organizations:</h5>
                            <div class="organization-toggles">
                                <!-- Organizations will be dynamically populated from admin settings -->
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <h5>Responsible Roles:</h5>
                            <div class="responsibility-toggles" id="responsibilityToggles">
                                <!-- Roles will be populated from settings -->
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <h5>Disciplinary Actions:</h5>
                            <div class="disciplinary-toggles" id="disciplinaryToggles">
                                <!-- Disciplinary actions will be populated from settings -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai-message">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <p>Hello! I'm your AI Policy Assistant. I'll help you create a professional healthcare policy step by step.</p>
                                <p>Let's start with the basics. What type of policy would you like to create?</p>
                                <div class="quick-options">
                                    <button class="btn btn-sm btn-outline" onclick="selectPolicyType('admin')">Admin Policy</button>
                                    <button class="btn btn-sm btn-outline" onclick="selectPolicyType('sog')">Standard Operating Guidelines</button>
                                    <button class="btn btn-sm btn-outline" onclick="selectPolicyType('protocol')">Protocol</button>
                                    <button class="btn btn-sm btn-outline" onclick="selectPolicyType('memo')">Communication Memo</button>
                                    <button class="btn btn-sm btn-outline" onclick="selectPolicyType('training')">Training Document</button>
                                    <button class="btn btn-sm btn-outline" onclick="selectPolicyType('governance')">Governance Policy</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type your message here..." onkeypress="handleChatKeyPress(event)">
                            <button onclick="sendChatMessage()" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="chat-actions">
                            <button onclick="resetChat()" class="btn btn-sm btn-secondary">
                                <i class="fas fa-refresh"></i> Start Over
                            </button>
                            <button onclick="generatePolicyFromChat()" class="btn btn-sm btn-success" id="generatePolicyBtn" style="display: none;">
                                <i class="fas fa-magic"></i> Generate Policy
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Loading and Result Sections -->
                <div id="aiSurveyForm" style="display: none;">
                    <div class="survey-step active" id="step1">
                        <h4>Step 1: Policy Overview</h4>
                        <div class="form-group">
                            <label for="aiPolicyTopic">What type of policy do you need?</label>
                            <input type="text" id="aiPolicyTopic" placeholder="e.g., Fire Evacuation, Hand Hygiene, Patient Safety, Data Security" required>
                        </div>
                        <div class="form-group">
                            <label for="aiPolicyType">What type of document is this?</label>
                            <select id="aiPolicyType" required>
                                <option value="">Select Type</option>
                                <option value="admin">Admin Policy (Official policy with compliance requirements)</option>
                                <option value="sog">Standard Operating Guidelines (Step-by-step procedures)</option>
                                <option value="protocol">Protocol (Detailed procedures and workflows)</option>
                                <option value="memo">Communication Memo (Staff announcement/update)</option>
                                <option value="training">Training Document (Educational materials and training resources)</option>
                                <option value="governance">Governance Policy (Corporate governance and compliance policies)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aiClinicApplicability">Which organizations does this apply to?</label>
                            <div class="checkbox-group" id="aiClinicApplicabilityCheckboxes">
                                <p style="color: #999;">Loading organizations...</p>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next</button>
                    </div>
                    
                    <div class="survey-step" id="step2">
                        <h4>Step 2: Policy Details</h4>
                        <div class="form-group">
                            <label for="aiSpecificNeeds">What specific needs or challenges does this policy address?</label>
                            <textarea id="aiSpecificNeeds" rows="3" placeholder="Describe the main issues, concerns, or goals this policy should address..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="aiUrgency">How urgent is this policy?</label>
                            <select id="aiUrgency">
                                <option value="immediate">Immediate (Need to implement right away)</option>
                                <option value="soon">Soon (Within the next month)</option>
                                <option value="planned">Planned (Part of regular policy updates)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aiRegulations">Are there specific regulations or standards this must comply with?</label>
                            <textarea id="aiRegulations" rows="2" placeholder="e.g., OSHA, HIPAA, AAHA guidelines, local regulations..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="aiExistingPolicies">Are there existing policies this should reference or replace?</label>
                            <textarea id="aiExistingPolicies" rows="2" placeholder="List any current policies, procedures, or documents..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="aiSpecialConsiderations">Any special considerations or unique aspects?</label>
                            <textarea id="aiSpecialConsiderations" rows="2" placeholder="Any specific requirements, limitations, or considerations..."></textarea>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="prevStep(1)">Previous</button>
                        <button type="button" class="btn btn-primary" onclick="generatePolicyFromSurvey()">Generate Policy</button>
                    </div>
                </div>
                
                <!-- Legacy form (hidden) -->
                <form id="aiForm" style="display: none;">
                    <div class="ai-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAIModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-magic"></i> Generate Policy
                        </button>
                    </div>
                </form>
                <div id="aiLoading" class="ai-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>AI is generating your policy...</p>
                </div>
                <div id="aiResult" class="ai-result" style="display: none;">
                    <h4>Generated Policy Preview</h4>
                    <div id="aiGeneratedContent"></div>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <h5 style="margin-bottom: 10px;">Refine This Policy</h5>
                        <p style="color: #666; margin-bottom: 15px;">Want to make changes? Send a follow-up prompt that includes the previous conversation context.</p>
                        <div class="chat-input" style="display: flex; gap: 10px;">
                            <input type="text" id="followUpInput" placeholder="Describe what you'd like to change or improve..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <button onclick="sendFollowUpPrompt()" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Send
                        </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Type Selection Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content signup-modal" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h3>Create Account</h3>
                <p class="modal-subtitle">Choose how you'd like to sign up</p>
                <span class="close" onclick="closeSignupModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                    <button onclick="showCompanySignup()" class="btn btn-success" style="padding: 20px; font-size: 16px; text-align: left; background: #10b981; border-color: #10b981; width: 100%; display: flex; align-items: center;">
                        <i class="fas fa-building" style="font-size: 1.5rem; margin-right: 15px;"></i>
                        <div style="text-align: left;">
                            <strong style="display: block;">Register Your Company</strong>
                            <small style="display: block; opacity: 0.9; font-size: 0.85rem; margin-top: 4px;">Set up a new company account</small>
                        </div>
                    </button>
                    
                    <button onclick="showCompanyCodeSignup()" class="btn btn-outline" style="padding: 20px; font-size: 16px; text-align: left; border: 2px solid #667eea; color: #667eea; width: 100%; display: flex; align-items: center;">
                        <i class="fas fa-key" style="font-size: 1.5rem; margin-right: 15px;"></i>
                        <div style="text-align: left;">
                            <strong style="display: block;">Sign Up with Company Code</strong>
                            <small style="display: block; opacity: 0.9; font-size: 0.85rem; margin-top: 4px;">Join an existing company</small>
                        </div>
                    </button>
                </div>
                
                <div class="modal-footer" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                    <p>Already have an account? <a href="#" onclick="closeSignupModal(); showLoginModal();">Log In</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pricing Modal -->
    <div id="pricingModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1100px;">
            <div class="modal-header">
                <h3>Register Your Company</h3>
                <p class="modal-subtitle">Select a plan to register your company or sign up with a company code</p>
                <span class="close" onclick="closePricingModal()">&times;</span>
            </div>
            <div class="modal-body" style="padding: 40px;">
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <!-- Free Trial Plan -->
                    <div class="pricing-card" onclick="selectPlan('free-trial')" style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s;">
                        <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-block; margin-bottom: 10px;">2 Week Trial</div>
                        <h4 style="margin: 0 0 10px 0; color: #333;">Free Trial</h4>
                        <div style="font-size: 2.5rem; font-weight: bold; color: #10b981; margin: 20px 0;">
                            FREE
                        </div>
                        <ul style="list-style: none; padding: 0; margin: 20px 0; text-align: left;">
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 10 users</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 1 organization</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 3 policies max</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> AI assistant</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Email support</li>
                        </ul>
                        <button class="btn btn-success" style="width: 100%; background: #10b981;" onclick="event.stopPropagation(); selectPlan('free-trial');">Start Free Trial</button>
                    </div>
                    
                    <!-- Basic Plan -->
                    <div class="pricing-card" onclick="selectPlan('basic')" style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s;">
                        <h4 style="margin: 0 0 10px 0; color: #333;">Basic</h4>
                        <div style="font-size: 2.5rem; font-weight: bold; color: #667eea; margin: 20px 0;">
                            $29<span style="font-size: 1rem; color: #666;">/month</span>
                        </div>
                        <ul style="list-style: none; padding: 0; margin: 20px 0; text-align: left;">
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 15 users</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 1 organization (single location)</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 3 policies max</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> AI assistant</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Email support</li>
                        </ul>
                        <button class="btn btn-outline" style="width: 100%;" onclick="event.stopPropagation(); selectPlan('basic');">Select Plan</button>
                    </div>
                    
                    <!-- Pro Plan -->
                    <div class="pricing-card" onclick="selectPlan('pro')" style="border: 3px solid #667eea; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s; background: #f8f9ff; position: relative;">
                        <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: #667eea; color: white; padding: 5px 20px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Most Popular</div>
                        <h4 style="margin: 15px 0 10px 0; color: #333;">Pro</h4>
                        <div style="font-size: 2.5rem; font-weight: bold; color: #667eea; margin: 20px 0;">
                            $99<span style="font-size: 1rem; color: #666;">/month</span>
                        </div>
                        <ul style="list-style: none; padding: 0; margin: 20px 0; text-align: left;">
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> 50 users</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Multi-location</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Unlimited policies</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> AI assistant</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Priority support</li>
                        </ul>
                        <button class="btn btn-primary" style="width: 100%;" onclick="event.stopPropagation(); selectPlan('pro');">Select Plan</button>
                    </div>
                </div>
                
                <!-- Enterprise Plan -->
                <div style="display: grid; grid-template-columns: 1fr; max-width: 600px; margin: 0 auto 30px auto;">
                    <div class="pricing-card" onclick="selectPlan('enterprise')" style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                        <h4 style="margin: 0 0 10px 0; color: #333;">Enterprise</h4>
                        <div style="font-size: 2.5rem; font-weight: bold; color: #667eea; margin: 20px 0;">
                            Custom
                        </div>
                        <p style="color: #666; margin-bottom: 20px;">Contact us for custom pricing and features</p>
                        <ul style="list-style: none; padding: 0; margin: 20px 0; text-align: left;">
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Unlimited users</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Unlimited organizations</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Unlimited policies</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> AI assistant</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Dedicated support</li>
                            <li style="margin: 10px 0;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i> Custom features</li>
                        </ul>
                        <button class="btn btn-outline" style="width: 100%;" onclick="event.stopPropagation(); selectPlan('enterprise');">Contact Sales</button>
                    </div>
                </div>
                
                <div style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 30px;">
                    <p><strong>No credit card required</strong> for the free trial. Cancel anytime.</p>
                </div>
                
                <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px dashed #d1d5db;">
                    <h4 style="margin: 0 0 10px 0; color: #333;">Already have a company code?</h4>
                    <p style="margin: 0 0 20px 0; color: #666;">Sign up using your company's access code</p>
                    <button onclick="showCompanyCodeSignup()" class="btn btn-outline" style="padding: 12px 30px; font-size: 1rem;">
                        <i class="fas fa-key"></i> Sign Up with Company Code
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Company Code Signup Modal -->
    <div id="companyCodeSignupModal" class="modal">
        <div class="modal-content signup-modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-key"></i>
                </div>
                <h3>Sign Up with Company Code</h3>
                <p class="modal-subtitle">Enter your company access code to join</p>
                <span class="close" onclick="closeCompanyCodeSignupModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="companyCodeSignupForm">
                    <div class="form-group">
                        <label for="companyCodeSignupUsername">Username</label>
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" id="companyCodeSignupUsername" placeholder="Enter your username" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="companyCodeSignupEmail">Email Address</label>
                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="companyCodeSignupEmail" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="companyCodeSignupPassword">Password</label>
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="companyCodeSignupPassword" placeholder="Create a password" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="companyCodeSignupAccessCode">Company Access Code</label>
                        <div class="input-group">
                            <i class="fas fa-key"></i>
                            <input type="text" id="companyCodeSignupAccessCode" placeholder="Enter your company access code" required>
                        </div>
                        <small class="form-help">Get your access code from your company administrator</small>
                    </div>
                    <div id="company-code-signup-error-message" class="error-message"></div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                    <div class="modal-footer">
                        <p>Want to register a new company? <a href="#" onclick="closeCompanyCodeSignupModal(); showCompanySignup();">View plans</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Individual Signup Modal -->
    <div id="individualSignupModal" class="modal">
        <div class="modal-content signup-modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-user"></i>
                </div>
                <h3>Create Personal Account</h3>
                <p class="modal-subtitle">Create your personal account</p>
                <span class="close" onclick="closeIndividualSignupModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="individualSignupForm">
                    <div class="form-group">
                        <label for="individualSignupUsername">Username</label>
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" id="individualSignupUsername" placeholder="Enter your username" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="individualSignupEmail">Email Address</label>
                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="individualSignupEmail" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="individualSignupPassword">Password</label>
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="individualSignupPassword" placeholder="Create a password" required>
                        </div>
                    </div>
                    <div id="individual-signup-error-message" class="error-message"></div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                    <div class="modal-footer">
                        <p>Already have an account? <a href="#" onclick="closeIndividualSignupModal(); showLoginModal();">Login here</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Company Signup Modal -->
    <div id="companySignupModal" class="modal" style="display: none;">
        <div class="modal-content signup-modal" style="max-width: 600px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <div class="modal-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3>Register Your Company</h3>
                <p class="modal-subtitle" id="companySignupSubtitle">Complete your registration</p>
                <span class="close" onclick="closeCompanySignupModal()">&times;</span>
            </div>
            <div class="modal-body" style="overflow-y: auto; flex: 1; max-height: calc(90vh - 200px); padding: 20px;">
                <form id="companySignupForm">
                    <!-- Company Information -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-building"></i> Company Information
                        </h4>
                        
                        <div class="form-group">
                            <label for="companyName">Company Name <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <i class="fas fa-building"></i>
                                <input type="text" id="companyName" placeholder="Enter your company name" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="companyIndustry">Industry (Optional)</label>
                            <div class="input-group">
                                <i class="fas fa-industry"></i>
                                <input type="text" id="companyIndustry" placeholder="e.g., Healthcare, Finance, Technology">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="companyPhone">Company Phone (Optional)</label>
                            <div class="input-group">
                                <i class="fas fa-phone"></i>
                                <input type="tel" id="companyPhone" placeholder="Enter company phone number">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Administrator Information -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-user-shield"></i> Administrator Account
                        </h4>
                        
                        <div class="form-group">
                            <label for="adminFullName">Full Name <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <i class="fas fa-user"></i>
                                <input type="text" id="adminFullName" placeholder="Enter your full name" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="adminEmail">Email Address <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="adminEmail" placeholder="Enter your email" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="adminUsername">Username <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <i class="fas fa-user-circle"></i>
                                <input type="text" id="adminUsername" placeholder="Choose a username" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="adminPassword">Password <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="adminPassword" placeholder="Create a password" required minlength="6">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="adminPasswordConfirm">Confirm Password <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="adminPasswordConfirm" placeholder="Confirm your password" required minlength="6">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="companyAdminPassword">
                                <span style="display: flex; align-items: center; gap: 5px;">
                                    Company Admin Password <span style="color: red;">*</span>
                                    <span style="position: relative; display: inline-block;">
                                        <i class="fas fa-question-circle" style="color: #667eea; cursor: help;" onmouseenter="showTooltip(this)" onmouseleave="hideTooltip(this)"></i>
                                        <span class="tooltip-text" style="position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 8px 12px; border-radius: 4px; font-size: 11px; white-space: nowrap; width: 200px; text-align: center; opacity: 0; pointer-events: none; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                                            Required to authorize changes to policies, users, and company settings. Keep it secure.
                                            <span style="position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 5px solid transparent; border-top-color: #333;"></span>
                                        </span>
                                    </span>
                                </span>
                            </label>
                            <div class="input-group">
                                <i class="fas fa-shield-alt"></i>
                                <input type="password" id="companyAdminPassword" placeholder="Create admin dashboard password" required minlength="6">
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">Used to access the admin dashboard</small>
                        </div>
                    </div>
                    
                    <!-- Selected Plan Info -->
                    <div style="background: linear-gradient(135deg, #f0f4ff, #e9ecff); padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                        <h4 style="margin: 0 0 10px 0; color: #667eea; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-credit-card"></i> Selected Plan: <span id="selectedPlanDisplay">Free Trial</span>
                        </h4>
                        <p style="margin: 0; color: #666; font-size: 0.9rem;">This can be changed later in your account settings</p>
                    </div>
                    
                    <div id="company-signup-error-message" class="error-message"></div>
                    
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-check-circle"></i>
                        Create Company Account
                    </button>
                    
                    <div class="modal-footer" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center;">
                        <p style="margin: 0;">Already have an account? <a href="#" onclick="closeCompanySignupModal(); showLoginModal();">Log In</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Policy Upload Modal -->
    <div id="uploadModal" class="modal" style="z-index: 3000;">
        <div class="modal-content upload-modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-upload"></i> Upload Policy Documents</h3>
                <span class="close" onclick="closeUploadModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="upload-container">
                    <!-- Drag and Drop Area -->
                    <div id="uploadArea" class="upload-area">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3>Drag & Drop Your Policy Documents Here</h3>
                        <p>or click to browse</p>
                        <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt" style="display: none;">
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-folder-open"></i>
                            Choose Files
                        </button>
                        <p class="upload-info">Supported formats: PDF, Word, Text files</p>
                    </div>

                    <!-- Processing Status -->
                    <div id="processingStatus" class="processing-status" style="display: none;">
                        <div class="processing-content">
                            <div class="processing-icon">
                                <i class="fas fa-cog fa-spin"></i>
                            </div>
                            <h3>Processing Documents...</h3>
                            <p id="processingMessage">Analyzing uploaded policies with AI</p>
                            <div class="progress-bar">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Uploaded Files Preview -->
                    <div id="uploadedFiles" class="uploaded-files" style="display: none;">
                        <h3>Uploaded Documents</h3>
                        <div id="fileList" class="file-list"></div>
                    </div>

                    <!-- AI Analysis Results -->
                    <div id="analysisResults" class="analysis-results" style="display: none;">
                        <h3>AI Analysis Results</h3>
                        <div id="analysisContent" class="analysis-content"></div>
                    </div>
                    
                    <!-- AI Edit Section - Appears after all uploaded policies are processed -->
                    <div id="globalAIEditSection" style="display: none; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 2px solid #667eea; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);">
                        <label style="display: block; margin-bottom: 12px; font-weight: 700; color: #333; font-size: 1.1rem;">
                            <i class="fas fa-robot" style="color: #667eea;"></i> Ask AI to Edit Uploaded Policies
                        </label>
                        <p style="margin: 0 0 12px 0; color: #666; font-size: 0.9rem;">
                            Request changes to any uploaded policy. Select the policy index and describe the changes you'd like.
                        </p>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                            <select id="globalAIPolicyIndex" style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 0.9rem; min-width: 100px;">
                                <option value="">Select Policy...</option>
                            </select>
                            <input type="text" id="globalAIEditInput" placeholder="E.g., Make it more detailed, add compliance section, simplify language..." 
                                   style="flex: 1; padding: 12px 15px; border: 2px solid #ddd; border-radius: 6px; font-size: 0.95rem; transition: border-color 0.3s;"
                                   onkeypress="if(event.key === 'Enter') { const idx = document.getElementById('globalAIPolicyIndex').value; if(idx !== '') sendAIEditRequest(parseInt(idx)); }"
                                   onfocus="this.style.borderColor='#667eea'"
                                   onblur="this.style.borderColor='#ddd'">
                            <button class="btn btn-primary" onclick="const idx = document.getElementById('globalAIPolicyIndex').value; if(idx !== '') sendAIEditRequest(parseInt(idx)); else showNotification('Please select a policy first', 'error');" 
                                    style="white-space: nowrap; padding: 12px 20px; background: #667eea; border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; transition: background 0.3s;"
                                    onmouseover="this.style.background='#5568d3'"
                                    onmouseout="this.style.background='#667eea'">
                                <i class="fas fa-paper-plane"></i> Send to AI
                            </button>
                        </div>
                        <div id="globalAIEditStatus" style="margin-top: 12px; display: none; padding: 10px; border-radius: 6px;"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="clearUploadArea()">
                    <i class="fas fa-redo"></i> Clear
                </button>
                <button type="button" class="btn btn-primary" onclick="closeUploadModal()">
                    Done
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay for n8n Automation -->
    <div id="n8nLoadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <h3 id="loadingTitle">Processing Document...</h3>
            <p id="loadingMessage">Uploading files and extracting data. Please wait...</p>
            <div class="loading-progress">
                <div id="loadingProgressBar" class="loading-progress-bar"></div>
            </div>
            <p id="loadingFileName" class="loading-file-name"></p>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-sign-in-alt"></i>
                </div>
                <h3>Welcome Back</h3>
                <p class="modal-subtitle">Sign in to access your company policies</p>
                <span class="close" onclick="closeLoginModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm" onsubmit="loginUser(event)">
                    <div class="form-group">
                        <label for="loginUsername">Username or Email</label>
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" id="loginUsername" placeholder="Enter your username or email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                        </div>
                    </div>
                    <div id="login-error-message" class="error-message"></div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                    <div class="modal-footer">
                        <p>Don't have an account? <a href="#" onclick="closeLoginModal(); showSignupModal();">Create one now</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin Access</h3>
                <span class="close" onclick="closePasswordModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label>Company Access:</label>
                        <div class="company-info" id="adminCompanyInfo">
                            <strong id="adminCompanyName">Loading...</strong>
                            <small id="adminCompanyUser">Loading...</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adminPasswordModal">Enter Admin Password for <span id="adminPasswordCompanyName">your company</span>:</label>
                        <input type="password" id="adminPasswordModal" placeholder="Enter your company's admin password" required>
                        <div id="error-message" class="error-message"></div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="checkAdminPassword(event)">Access Admin</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal" style="z-index: 2000;">
        <div class="modal-content admin-modal-content">
            <div class="modal-header">
                <h3>Policy Pro Admin Dashboard</h3>
                <span class="close" onclick="closeAdminModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="admin-stats">
                    <div class="stat-card">
                        <i class="fas fa-file-alt"></i>
                        <h3 id="adminTotalPolicies">0</h3>
                        <p>Total Policies</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-edit"></i>
                        <h3 id="adminDraftCount">0</h3>
                        <p>Draft Policies</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="adminUserCount">0</h3>
                        <p>Total Users</p>
                    </div>
                </div>
                
                <div class="admin-actions">
                    <button class="btn btn-primary" onclick="openCreateModal()">
                        <i class="fas fa-plus"></i> Create New Policy
                    </button>
                    <button class="btn btn-secondary" onclick="openAIModal()">
                        <i class="fas fa-robot"></i> AI Policy Generator
                    </button>
                    <button class="btn btn-info" onclick="openPoliciesModal()">
                        <i class="fas fa-file-alt"></i> Manage Policies
                    </button>
                    <button class="btn btn-primary" onclick="openUsersModal()" style="background: #8B5CF6; border-color: #8B5CF6;">
                        <i class="fas fa-users-cog"></i> Manage Users
                    </button>
                    <button class="btn btn-success" onclick="openUploadModal()">
                        <i class="fas fa-upload"></i> Upload Policy Documents
                    </button>
                    <button class="btn btn-warning" onclick="openSettingsModal()">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                    <button class="btn btn-danger" onclick="clearAllLocalStorage()">
                        <i class="fas fa-trash-alt"></i> Clear All Data
                    </button>
                </div>
                
                <!-- Draft Management Section -->
                <div class="draft-management">
                    <h3>Draft Policies</h3>
                    <div id="adminDraftList" class="draft-list">
                        <!-- Drafts will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Center Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal-content">
            <div class="modal-header">
                <h3>Profile Center</h3>
                <span class="close" onclick="closeProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h3 id="profileUserName">Guest User</h3>
                            <p id="profileUserCompany">Not logged in</p>
                            <span class="profile-status" id="profileUserStatus">Inactive</span>
                        </div>
                    </div>
                </div>

                <div class="profile-tabs">
                    <button class="tab-btn active" onclick="showProfileTab('account')">Account Info</button>
                    <button class="tab-btn" onclick="showProfileTab('security')">Security</button>
                    <button class="tab-btn" onclick="showProfileTab('preferences')">Preferences</button>
                </div>

                <!-- Account Info Tab -->
                <div id="accountTab" class="profile-tab active">
                    <div class="profile-section">
                        <h4>Account Information</h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Username</label>
                                <span id="profileUsername">guest</span>
                            </div>
                            <div class="info-item">
                                <label>Email</label>
                                <span id="profileEmail">guest@example.com</span>
                            </div>
                            <div class="info-item">
                                <label>Company</label>
                                <span id="profileCompany">Not assigned</span>
                            </div>
                            <div class="info-item">
                                <label>Role</label>
                                <span id="profileRole">Guest</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Tab -->
                <div id="securityTab" class="profile-tab">
                    <div class="profile-section">
                        <h4>Security Settings</h4>
                        <div class="security-options">
                            <button class="btn btn-primary" onclick="showChangePasswordModal()">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Preferences Tab -->
                <div id="preferencesTab" class="profile-tab">
                    <div class="profile-section">
                        <h4>User Preferences</h4>
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e9ecef; text-align: center;">
                            <i class="fas fa-lock" style="font-size: 48px; color: #6c757d; margin-bottom: 15px;"></i>
                            <p style="color: #6c757d; font-size: 1rem; margin: 0;">Preferences are currently locked and cannot be modified.</p>
                        </div>
                        <div class="preference-options" style="opacity: 0.5; pointer-events: none; margin-top: 20px;">
                            <div class="preference-item">
                                <label>
                                    <input type="checkbox" checked disabled>
                                    Email notifications for new policies
                                </label>
                            </div>
                            <div class="preference-item">
                                <label>
                                    <input type="checkbox" checked disabled>
                                    Weekly policy updates
                                </label>
                            </div>
                            <div class="preference-item">
                                <label>
                                    <input type="checkbox" disabled>
                                    Daily activity summaries
                                </label>
                            </div>
                            <div class="preference-item">
                                <label>
                                    <input type="checkbox" checked disabled>
                                    System maintenance alerts
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Role Modal -->
    <div id="addRoleModal" class="modal" style="z-index: 4000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New Role</h3>
                <span class="close" onclick="closeAddRoleModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addRoleForm" onsubmit="event.preventDefault(); addRole();">
                    <div class="form-group">
                        <label for="modalRoleName">
                            <i class="fas fa-briefcase"></i> Role Name <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="modalRoleName" placeholder="e.g., Senior Veterinarian, Clinic Manager" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalRoleDescription">
                            <i class="fas fa-info-circle"></i> Role Description <span style="color: red;">*</span>
                        </label>
                        <textarea id="modalRoleDescription" placeholder="Describe the responsibilities and duties of this role..." required
                                  rows="3" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="modalRoleStaffName">
                            <i class="fas fa-user"></i> Staff Member Name <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="modalRoleStaffName" placeholder="Full name of the staff member" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalRoleEmail">
                            <i class="fas fa-envelope"></i> Staff Email <span style="color: red;">*</span>
                        </label>
                        <input type="email" id="modalRoleEmail" placeholder="staff@example.com" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddRoleModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Add Role
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Disciplinary Action Modal -->
    <div id="addDisciplinaryModal" class="modal" style="z-index: 4000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-gavel"></i> Add Disciplinary Action</h3>
                <span class="close" onclick="closeAddDisciplinaryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addDisciplinaryForm" onsubmit="event.preventDefault(); addDisciplinaryAction();">
                    <div class="form-group">
                        <label for="modalActionName">
                            <i class="fas fa-exclamation-triangle"></i> Action Name <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="modalActionName" placeholder="e.g., Verbal Warning, Written Warning" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalActionDescription">
                            <i class="fas fa-info-circle"></i> Description <span style="color: red;">*</span>
                        </label>
                        <textarea id="modalActionDescription" placeholder="Describe the disciplinary action..." required
                                  rows="3" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="modalActionPenalties">
                            <i class="fas fa-shield-alt"></i> Penalties <span style="color: red;">*</span>
                        </label>
                        <textarea id="modalActionPenalties" placeholder="List penalties or consequences..." required
                                  rows="2" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="modalActionSeverity">
                            <i class="fas fa-sliders-h"></i> Severity Level <span style="color: red;">*</span>
                        </label>
                        <select id="modalActionSeverity" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                            <option value="minor">Minor</option>
                            <option value="moderate">Moderate</option>
                            <option value="major">Major</option>
                            <option value="severe">Severe</option>
                        </select>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddDisciplinaryModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Add Action
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Organization Modal -->
    <div id="addOrganizationModal" class="modal" style="z-index: 4000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-building"></i> Add Organization</h3>
                <span class="close" onclick="closeAddOrganizationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addOrganizationForm" onsubmit="event.preventDefault(); addOrganization();">
                    <div class="form-group">
                        <label for="modalOrgName">
                            <i class="fas fa-building"></i> Organization Name <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="modalOrgName" placeholder="e.g., Downtown Clinic" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalOrgAddress">
                            <i class="fas fa-map-marker-alt"></i> Address
                        </label>
                        <textarea id="modalOrgAddress" placeholder="Organization address..." rows="2"
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="modalOrgPhone">
                            <i class="fas fa-phone"></i> Phone Number
                        </label>
                        <input type="tel" id="modalOrgPhone" placeholder="(123) 456-7890"
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalOrgEmail">
                            <i class="fas fa-envelope"></i> Email Address
                        </label>
                        <input type="email" id="modalOrgEmail" placeholder="organization@example.com"
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddOrganizationModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Add Organization
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Document Modal -->
    <div id="addDocumentModal" class="modal" style="z-index: 4000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> Add Document</h3>
                <span class="close" onclick="closeAddDocumentModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addDocumentForm" onsubmit="event.preventDefault(); addDocument();">
                    <div class="form-group">
                        <label for="modalDocName">
                            <i class="fas fa-file"></i> Document Name <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="modalDocName" placeholder="e.g., HIPAA Compliance Guide" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalDocUrl">
                            <i class="fas fa-link"></i> URL or File Path <span style="color: red;">*</span>
                        </label>
                        <input type="url" id="modalDocUrl" placeholder="https://example.com/document.pdf" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalDocDescription">
                            <i class="fas fa-info-circle"></i> Description
                        </label>
                        <textarea id="modalDocDescription" placeholder="Optional description of the document..." rows="3"
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px; resize: vertical;"></textarea>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddDocumentModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Add Document
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal" style="z-index: 4000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-folder-plus"></i> Add New Category</h3>
                <span class="close" onclick="closeAddCategoryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addCategoryForm" onsubmit="event.preventDefault(); addCategory();">
                    <div class="form-group">
                        <label for="modalCategoryName">
                            <i class="fas fa-tag"></i> Category Name <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="modalCategoryName" placeholder="e.g., Safety Policies, HR Guidelines, Clinical Procedures" required
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                    </div>
                    <div class="form-group">
                        <label for="modalCategoryNumber">
                            <i class="fas fa-hashtag"></i> Category Number <span style="color: red;">*</span>
                        </label>
                        <input type="number" id="modalCategoryNumber" placeholder="e.g., 1, 2, 3" required min="1"
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px;">
                        <small style="color: #666; display: block; margin-top: 5px;">Used for policy code generation (e.g., Type.Category#.Policy#.Year)</small>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddCategoryModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Add Category
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Policy Advisor Modal -->
    <div id="policyAdvisorModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-robot"></i> Policy Advisor</h3>
                <span class="close" onclick="closePolicyAdvisor()">&times;</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #666;">
                    Ask a question and we'll analyze your policies to provide guidance.
                </p>
                
                <div class="form-group">
                    <label for="advisorQuestion" style="font-weight: 600;">Your Question:</label>
                    <textarea id="advisorQuestion" rows="4" 
                              placeholder="e.g., What should I do if a staff member arrives late multiple times?"
                              style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px;"></textarea>
                </div>

                <div id="advisorLoading" style="display: none; text-align: center; padding: 30px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: #667eea;"></i>
                    <p style="margin-top: 15px; color: #666;">Analyzing your policies...</p>
                </div>

                <div id="advisorResponse" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 6px; margin-top: 20px;">
                    <h4 style="margin-top: 0; color: #333;">Recommendation:</h4>
                    <div id="advisorResultText" style="color: #555; line-height: 1.8; white-space: pre-wrap;"></div>
                </div>

                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closePolicyAdvisor()">Close</button>
                    <button type="button" class="btn btn-primary" onclick="sendPolicyAdvisorRequest()">
                        <i class="fas fa-search"></i> Get Recommendation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <span class="close" onclick="closeChangePasswordModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm" onsubmit="changeUserPassword(event)">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" required minlength="8">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" id="confirmPassword" required minlength="8">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeChangePasswordModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="policy-pro-logo.svg" alt="Logo" class="logo-img">
                </div>
                <p>&copy; 2024 Policy Pro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js?v=179&t=20250202"></script>
</body>
</html>
